import N from"./CCfbrQ0X.js";import M from"./CVrS0DO9.js";import P from"./CxcjPVh1.js";import z from"./CbP83ycS.js";import{d as I,N as $,r as l,G as j,M as K,q as m,v as k,z as n,A as c,t as _,P as o,Q as V,S as q,R as A,x as v,y as D,B as C,C as H,D as L,_ as R}from"./a5S8uhhp.js";import"./BNzTQQIY.js";import"./pt086Vdl.js";import"./DCL0i9Lx.js";import"./BhA3Fdbb.js";import"./C6nyDDVh.js";import"./BqOQZgXw.js";import"./DrIebjZr.js";import"./BR0SHnIP.js";import"./D_BPq--A.js";import"./DMbrpos3.js";const U=f=>(H("data-v-efb8c451"),f=f(),L(),f),G={key:0,class:"content",style:{"max-height":"100vh"}},O={style:{"text-align":"center"}},Q=["innerHTML"],F={key:1},J={class:"wrapper"},W=U(()=>v("span",{class:"pi pi-star",style:{"font-size":"100px"}},null,-1)),X=I({__name:"index",setup(f){const d=$(),x=l([]),u=l({}),h=l([]),y=l(""),g=l(""),b=l(!1),S=l(""),w=l(!1);function B(i,t){const s=new Map;t.sort((e,r)=>e.id-r.id).forEach(e=>{s.set(e.id,{key:e.id.toString(),label:e.title,data:e.path,subscribable:e.subscribable,icon:e.subscribable?"pi pi-star-fill":"pi pi-fw pi-folder",children:[]})});const a=[];return i.sort((e,r)=>e.id-r.id).forEach(e=>{const r={key:e.id.toString(),label:e.title,subscribable:e.subscribable,icon:e.subscribable?"pi pi-star":"pi pi-fw pi-file",data:e.body};e.path&&s.has(e.path)?s.get(e.path).children.push(r):a.push(r)}),s.forEach(e=>a.push(e)),a}j(u,()=>{var s;const i=Number((s=Object.entries(u.value).find(([a,e])=>e))==null?void 0:s[0]),t=h.value.find(a=>a.id===i);t?(g.value=t.title,y.value=t.body,w.value=t.subscribable):(g.value="",y.value="",w.value=!1)});const T=l(!1);return K(async()=>{try{const{data:t,error:s}=await d.from("post").select("*");if(s)throw s;h.value=t||[];const{data:a,error:e}=await d.from("catalog").select("*");if(e)throw e;x.value=B(h.value,a||[])}catch(t){console.error("Error fetching data:",t)}const i=await d.auth.getUser();if(i.data.user){let{data:t,error:s}=await d.from("profile").select("*").eq("user_id",i.data.user.id.toString());S.value=i.data.user.id.toString(),(t==null?void 0:t.length)!==0?(b.value=t[0].is_subscrable,T.value=t[0].is_admin):m("/login")}else m("/login")}),(i,t)=>{const s=N,a=M,e=P,r=z;return _(),k("div",null,[n(r,{style:{height:"98vh"},class:"mb-5"},{default:c(()=>[n(a,{class:"flex align-items-center justify-content-center",size:10},{default:c(()=>[n(r,{style:{height:"98vh"},layout:"vertical"},{default:c(()=>[n(a,{size:100},{default:c(()=>[n(s,{selectionKeys:o(u),"onUpdate:selectionKeys":t[0]||(t[0]=p=>V(u)?u.value=p:null),value:o(x),selectionMode:"single",style:{"padding-left":"0"}},null,8,["selectionKeys","value"])]),_:1}),n(a,{class:"flex align-items-center justify-content-center",size:10,style:{display:"flex",padding:"1cap",gap:"1cap"}},{default:c(()=>[n(e,{label:"Профиль",onClick:t[1]||(t[1]=p=>("navigateTo"in i?i.navigateTo:o(m))("/profile"))}),o(T)?(_(),q(e,{key:0,label:"Админ",onClick:t[2]||(t[2]=p=>("navigateTo"in i?i.navigateTo:o(m))("/editor"))})):A("",!0)]),_:1})]),_:1})]),_:1}),n(a,{class:"flex align-items-center justify-content-center"},{default:c(()=>[o(b)===!0||o(b)===!1&&o(w)===!1?(_(),k("div",G,[v("h1",O,D(o(g)),1),v("div",{innerHTML:o(y)},null,8,Q)])):(_(),k("div",F,[v("div",J,[W,C(' Приобретите подписку "Plus" для доступа ко всему материалу! '),n(e,{onClick:t[3]||(t[3]=async()=>{const{data:p,error:E}=await o(d).from("profile").update({is_subscrable:!0}).eq("user_id",o(S)).select();E||(b.value=p[0].is_subscrable)})},{default:c(()=>[C(" Приобрести")]),_:1})])]))]),_:1})]),_:1})])}}}),fe=R(X,[["__scopeId","data-v-efb8c451"]]);export{fe as default};
