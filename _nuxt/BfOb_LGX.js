import S from"./RP2cCwie.js";import N from"./BidcTM-k.js";import T from"./BmV3be56.js";import z from"./CPHfb7Ji.js";import A from"./B67HGTHM.js";import P from"./CxcjPVh1.js";import{d as M,N as Z,O as D,u as E,r as g,M as F,v as L,z as u,x as d,P as o,Q as c,S as h,A as R,R as k,t as w,C as O,D as Q,_ as W}from"./a5S8uhhp.js";import"./DHiw4w8_.js";import"./DCL0i9Lx.js";import"./BqOQZgXw.js";import"./pt086Vdl.js";import"./BI4_4fht.js";import"./Dw1bkD2C.js";import"./BcUNBtQY.js";import"./3NOV7ffi.js";import"./CT9HAKpH.js";import"./DMbrpos3.js";import"./BhA3Fdbb.js";const _=v=>(O("data-v-d67ca1e9"),v=v(),Q(),v),j={class:"wrapper"},q={class:"variant"},G=_(()=>d("label",{for:"ingredient1",class:"ml-2"},"Вход",-1)),H=_(()=>d("label",{for:"ingredient2",class:"ml-2"},"Регистрация",-1)),J=_(()=>d("label",{for:"username"},"Имя пользователя",-1)),K=_(()=>d("label",{for:"email"},"Почта",-1)),X=_(()=>d("label",{for:"password"},"Пароль",-1)),Y=M({__name:"login",setup(v){const V=Z(),y=D(),x=E(),m=g(""),s=g(""),f=g(""),t=g("Вход");F(async()=>{(await V.auth.getUser()).data&&x.push("/profile")});const I=(a,e,r)=>{if(t.value!=="Вход"){if(a.trim()==="")return{isValid:!1,error:"Имя пользователя не может быть пустым."};if(a.length<3||a.length>20)return{isValid:!1,error:"Имя пользователя должно быть от 3 до 20 символов."};if(!/^[a-zA-Zа-яА-Я0-9_]+$/.test(a))return{isValid:!1,error:"Имя пользователя может содержать только буквы, цифры и символ подчеркивания."}}if(e.trim()==="")return{isValid:!1,error:"Электронная почта не может быть пустой."};if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e))return{isValid:!1,error:"Некорректный формат электронной почты."};if(r.trim()==="")return{isValid:!1,error:"Пароль не может быть пустым."};if(t.value!=="Вход"){if(r.length<8)return{isValid:!1,error:"Пароль должен быть не менее 8 символов."};if(!/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).+$/.test(r))return{isValid:!1,error:"Пароль должен содержать хотя бы одну заглавную букву, одну строчную букву и одну цифру."}}return{isValid:!0,error:""}},U=async()=>{const a=I(f.value,m.value,s.value);if(!a.isValid){y.add({severity:"error",summary:"Ошибка",detail:a.error,life:3e3});return}t.value==="Вход"?await $(m.value,s.value):await B(f.value,m.value,s.value)},$=async(a,e)=>{const{data:r,error:i}=await V.auth.signInWithPassword({email:a,password:e});i?y.add({severity:"error",summary:"Ошибка",detail:i.message,life:3e3}):x.push("/profile")},B=async(a,e,r)=>{var p;const{data:i,error:n}=await V.auth.signUp({email:e,password:r});if(n)y.add({severity:"error",summary:"Ошибка",detail:n.message,life:3e3});else{const b=await V.from("profile").insert({user_id:(p=i.user)==null?void 0:p.id,username:a}).select();console.log(b),x.push("/profile")}};return(a,e)=>{const r=S,i=N,n=T,p=z,b=A,C=P;return w(),L("div",j,[u(r),d("div",q,[d("div",null,[u(i,{modelValue:o(t),"onUpdate:modelValue":e[0]||(e[0]=l=>c(t)?t.value=l:null),inputId:"ingredient1",value:"Вход"},null,8,["modelValue"]),G]),d("div",null,[u(i,{modelValue:o(t),"onUpdate:modelValue":e[1]||(e[1]=l=>c(t)?t.value=l:null),inputId:"ingredient2",value:"Регистрация"},null,8,["modelValue"]),H])]),o(t)==="Регистрация"?(w(),h(p,{key:0},{default:R(()=>[u(n,{class:"field",id:"username",modelValue:o(f),"onUpdate:modelValue":e[2]||(e[2]=l=>c(f)?f.value=l:null)},null,8,["modelValue"]),J]),_:1})):k("",!0),u(p,null,{default:R(()=>[u(n,{class:"field",id:"email",modelValue:o(m),"onUpdate:modelValue":e[3]||(e[3]=l=>c(m)?m.value=l:null)},null,8,["modelValue"]),K]),_:1}),u(p,null,{default:R(()=>[o(t)!=="Регистрация"?(w(),h(n,{key:0,class:"field",type:"password",modelValue:o(s),"onUpdate:modelValue":e[4]||(e[4]=l=>c(s)?s.value=l:null)},null,8,["modelValue"])):k("",!0),o(t)=="Регистрация"?(w(),h(b,{key:1,modelValue:o(s),"onUpdate:modelValue":e[5]||(e[5]=l=>c(s)?s.value=l:null),toggleMask:""},null,8,["modelValue"])):k("",!0),X]),_:1}),u(C,{label:o(t),onClick:U},null,8,["label"])])}}}),ge=W(Y,[["__scopeId","data-v-d67ca1e9"]]);export{ge as default};
