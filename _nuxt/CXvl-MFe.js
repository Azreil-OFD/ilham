import ne from"./BTM7GVIx.js";import oe from"./qC_NbDLF.js";import ae from"./HKxpJP38.js";import ie from"./1BxHBaO_.js";import le from"./CQqpq79b.js";import re from"./BLFtdMoP.js";import se from"./s_RXbpHR.js";import ue from"./CxrlOMdH.js";import de from"./BFxPttFm.js";import{G as R,d as Y,L as ce,r as C,M as G,o as fe,e as ve,I as me,H as pe,g as W,N as ye,O as ge,c as be,v as K,z as h,A as N,P as s,Q as T,t as E,x as w,R as j,S as O,q as he,B as _e,C as Ce,D as Se,_ as we}from"./Ch2-AutY.js";import"./BDJurBW2.js";import"./BaJ8eWHk.js";import"./Dg2yOUuB.js";import"./7SHgwS-N.js";import"./CMOB889e.js";import"./B56lg8N-.js";import"./DtHlZVGT.js";import"./CBj3qXeg.js";import"./DdiXxcBO.js";import"./am_Z2FcC.js";import"./BBxZe1To.js";import"./CNxwzglz.js";import"./qggyaAap.js";import"./DyBAmXzV.js";import"./EpMrqakN.js";import"./kQiydjpm.js";var Ve=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],ke=function(e){return Ve.map(function(a){return a.toLowerCase()}).indexOf(e.toLowerCase())!==-1},Ee=function(e,a,n){Object.keys(a).filter(ke).forEach(function(u){var i=a[u];typeof i=="function"&&(u==="onInit"?i(e,n):n.on(u.substring(2),function(r){return i(r,n)}))})},xe=function(e,a,n,u){var i=e.modelEvents?e.modelEvents:null,r=Array.isArray(i)?i.join(" "):i;R(u,function(v,g){n&&typeof v=="string"&&v!==g&&v!==n.getContent({format:e.outputFormat})&&n.setContent(v)}),n.on(r||"change input undo redo",function(){a.emit("update:modelValue",n.getContent({format:e.outputFormat}))})},Ie=function(e,a,n,u,i,r){u.setContent(r()),n.attrs["onUpdate:modelValue"]&&xe(a,n,u,i),Ee(e,n.attrs,u)},Q=0,Z=function(e){var a=Date.now(),n=Math.floor(Math.random()*1e9);return Q++,e+"_"+n+Q+String(a)},Te=function(e){return e!==null&&e.tagName.toLowerCase()==="textarea"},J=function(e){return typeof e>"u"||e===""?[]:Array.isArray(e)?e:e.split(" ")},je=function(e,a){return J(e).concat(J(a))},Pe=function(e){return e==null},X=function(){return{listeners:[],scriptId:Z("tiny-script"),scriptLoaded:!1}},Ue=function(){var e=X(),a=function(i,r,v,g){var l=r.createElement("script");l.referrerPolicy="origin",l.type="application/javascript",l.id=i,l.src=v;var S=function(){l.removeEventListener("load",S),g()};l.addEventListener("load",S),r.head&&r.head.appendChild(l)},n=function(i,r,v){e.scriptLoaded?v():(e.listeners.push(v),i.getElementById(e.scriptId)||a(e.scriptId,i,r,function(){e.listeners.forEach(function(g){return g()}),e.scriptLoaded=!0}))},u=function(){e=X()};return{load:n,reinitialize:u}},Ne=Ue(),Be=function(){return typeof window<"u"?window:global},B=function(){var e=Be();return e&&e.tinymce?e.tinymce:null},De={apiKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(e){return e==="html"||e==="text"}}},D=function(){return D=Object.assign||function(e){for(var a,n=1,u=arguments.length;n<u;n++){a=arguments[n];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},D.apply(this,arguments)},Me=function(e,a,n,u){return e(u||"div",{id:a,ref:n})},Oe=function(e,a,n){return e("textarea",{id:a,visibility:"hidden",ref:n})},Le=Y({props:De,setup:function(e,a){var n=e.init?D({},e.init):{},u=ce(e),i=u.disabled,r=u.modelValue,v=u.tagName,g=C(null),l=null,S=e.id||Z("tiny-vue"),x=e.init&&e.init.inline||e.inline,_=!!a.attrs["onUpdate:modelValue"],V=!0,z=e.initialValue?e.initialValue:"",k="",I=function(p){return _?function(){return r!=null&&r.value?r.value:""}:function(){return p?z:k}},U=function(){var p=I(V),y=D(D({},n),{readonly:e.disabled,selector:"#"+S,plugins:je(n.plugins,e.plugins),toolbar:e.toolbar||n.toolbar,inline:x,setup:function(P){l=P,P.on("init",function(q){return Ie(q,e,a,P,r,p)}),typeof n.setup=="function"&&n.setup(P)}});Te(g.value)&&(g.value.style.visibility=""),B().init(y),V=!1};R(i,function(p){var y;l!==null&&(typeof((y=l.mode)===null||y===void 0?void 0:y.set)=="function"?l.mode.set(p?"readonly":"design"):l.setMode(p?"readonly":"design"))}),R(v,function(p){var y;_||(k=l.getContent()),(y=B())===null||y===void 0||y.remove(l),G(function(){return U()})}),fe(function(){if(B()!==null)U();else if(g.value&&g.value.ownerDocument){var p=e.cloudChannel?e.cloudChannel:"5",y=e.apiKey?e.apiKey:"no-api-key",P=Pe(e.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/"+y+"/tinymce/"+p+"/tinymce.min.js":e.tinymceScriptSrc;Ne.load(g.value.ownerDocument,P,U)}}),ve(function(){B()!==null&&B().remove(l)}),x||(me(function(){V||U()}),pe(function(){var p;_||(k=l.getContent()),(p=B())===null||p===void 0||p.remove(l)}));var L=function(p){var y;k=l.getContent(),(y=B())===null||y===void 0||y.remove(l),n=D(D({},n),p),G(function(){return U()})};return a.expose({rerender:L}),function(){return x?Me(W,S,g,e.tagName):Oe(W,S,g)}}});const $=e=>(Ce("data-v-77791752"),e=e(),Se(),e),Ae={class:"p-fluid"},$e={class:"p-field"},ze=$(()=>w("label",{for:"type"},"Выберите тип:",-1)),Ke={key:0},Re={class:"p-field"},qe=$(()=>w("label",{for:"type"},"Выберите каталог:",-1)),Fe=$(()=>w("label",{for:"postTitle"},"Название поста:",-1)),Ge={key:1},He={class:"p-field"},We=$(()=>w("label",{for:"catalogTitle"},"Название каталога:",-1)),Qe={class:"p-dialog-footer",style:{"padding-top":"1vh"}},Je=$(()=>w("h3",{style:{"margin-bottom":"10px"}},"Админ панель",-1)),Xe={key:0,style:{"align-items":"center","justify-content":"space-between",display:"flex",padding:"3px 0"}},Ye={class:"div",style:{display:"flex","align-items":"center"}},Ze=Y({__name:"editor",setup(e){const a=C(!1),n=ye(),u=C([]),i=C({}),r=C(""),v=C(""),g=C([]),l=ge(),S=C(""),x=C(""),_=C(!1),V=C(!1),z=C([{label:"/",value:null}]),k=C({label:null,value:null}),I=C({label:null,value:null}),U={plugins:"lists link image table code help wordcount"},L=be(()=>{var d;return Number((d=Object.entries(i.value).find(([t,f])=>f===!0))==null?void 0:d[0])});function p(d,t){const f=new Map;t.sort((o,b)=>o.id-b.id).forEach(o=>{z.value.push({label:o.title,value:o.id}),f.set(o.id,{key:o.id.toString(),label:o.title,subscribable:o.subscribable,icon:o.subscribable?"pi pi-star-fill":"pi pi-fw pi-folder",children:[]})});const m=[];return d.sort((o,b)=>o.id-b.id).forEach(o=>{var A;const b={key:o.id.toString(),label:o.title,subscribable:o.subscribable,icon:o.subscribable?"pi pi-star":"pi pi-fw pi-file",data:o.body};o.path&&f.has(o.path)?(f.get(o.path).subscribable&&(b.icon="pi pi-star"),(A=f.get(o.path).children)==null||A.push(b)):m.push(b)}),f.forEach(o=>{m.push(o)}),m}async function y(){var d;if(v.value&&r.value)try{const t=Number((d=Object.entries(i.value).find(([o,b])=>b===!0))==null?void 0:d[0]),{data:f,error:m}=await n.from("post").update({title:v.value,body:r.value,subscribable:V.value}).eq("id",t).select();m?(console.log(m),l.add({severity:"error",summary:"Ошибка",detail:`Код ошибки: ${m.code}. Обратитесь в службу поддержки!`,life:3e3})):l.add({severity:"success",summary:"Успешно",detail:"Пост сохранен!",life:3e3})}catch{l.add({severity:"error",summary:"Ошибка",detail:"Заполните все поля!",life:3e3})}else l.add({severity:"error",summary:"Ошибка",detail:"Заполните все поля!",life:3e3})}function P(d){const t=d.trim().split(/\s+/);return(t.shift()||"").toLowerCase()+t.map(o=>o.charAt(0).toUpperCase()+o.slice(1).toLowerCase()).join("")}async function q(){if(I.value.value==="catalog"){const{data:d,error:t}=await n.from("catalog").insert([{title:x.value,path:P(x.value)}]).select();t?l.add({severity:"error",summary:"Ошибка",detail:`Код ошибки: ${t.code}. Обратитесь в службу поддержки!`,life:3e3}):(l.add({severity:"success",summary:"Успешно",detail:"Пост сохранен!",life:3e3}),a.value=!1)}else if(I.value.value==="post"){console.log({title:S.value,path:k.value.value});const{data:d,error:t}=await n.from("post").insert([{title:S.value,path:k.value.value}]).select();t?l.add({severity:"error",summary:"Ошибка",detail:`Код ошибки: ${t.code}. Обратитесь в службу поддержки!`,life:3e3}):(l.add({severity:"success",summary:"Успешно",detail:"Пост сохранен!",life:3e3}),a.value=!1)}}R(i,async()=>{var d,t;if(i.value!==void 0){v.value="",r.value="",V.value=!1;try{const f=Number((d=Object.entries(i.value).find(([o,b])=>b===!0))==null?void 0:d[0]);if(_.value){if(!f){const o=(t=Object.entries(i.value).find(([A,M])=>M===!0))==null?void 0:t[0];if(o===void 0)return;const{error:b}=await n.from("catalog").delete().eq("id",o);b&&console.log(b)}if(Number.isInteger(f)){const{error:o}=await n.from("post").delete().eq("id",f);o&&console.log(o)}return}if(Number.isNaN(f))return;const m=g.value.find(o=>o.id===f);v.value=m.title,r.value=m.body,console.log(m),V.value=m==null?void 0:m.subscribable}catch(f){console.error("Error updating selected post:",f)}}});async function F(){try{const{data:d}=await n.from("post").select("*");g.value=d;const{data:t}=await n.from("catalog").select("*");u.value=p(d,t),console.log(d,t)}catch(d){console.error("Error fetching data:",d)}}return G(async()=>{await F()}),n.channel("custom-all-channel-post").on("postgres_changes",{event:"*",schema:"public",table:"post"},async()=>{await F()}).subscribe(),n.channel("custom-all-channel-catalog").on("postgres_changes",{event:"*",schema:"public",table:"catalog"},async()=>{await F()}).subscribe(),(d,t)=>{const f=ne,m=oe,o=ae,b=ie,A=le,M=re,H=se,ee=ue,te=de;return E(),K("div",null,[h(b,{visible:s(a),"onUpdate:visible":t[4]||(t[4]=c=>T(a)?a.value=c:null),modal:"",header:"Добавить",style:{width:"25rem"}},{default:N(()=>[w("div",Ae,[w("div",$e,[ze,h(f,{modelValue:s(I),"onUpdate:modelValue":t[0]||(t[0]=c=>T(I)?I.value=c:null),options:[{label:"Пост",value:"post"},{label:"Каталог",value:"catalog"}],optionLabel:"label"},null,8,["modelValue"])]),s(I).value==="post"?(E(),K("div",Ke,[w("div",Re,[qe,h(f,{modelValue:s(k),"onUpdate:modelValue":t[1]||(t[1]=c=>T(k)?k.value=c:null),options:s(z),optionLabel:"label"},null,8,["modelValue","options"]),Fe,h(m,{id:"postTitle",modelValue:s(S),"onUpdate:modelValue":t[2]||(t[2]=c=>T(S)?S.value=c:null)},null,8,["modelValue"])])])):j("",!0),s(I).value==="catalog"?(E(),K("div",Ge,[w("div",He,[We,h(m,{id:"catalogTitle",modelValue:s(x),"onUpdate:modelValue":t[3]||(t[3]=c=>T(x)?x.value=c:null)},null,8,["modelValue"])])])):j("",!0),w("div",Qe,[h(o,{label:"Добавить",onClick:q})])])]),_:1},8,["visible"]),Je,h(H,{style:{height:"93vh"},class:"mb-5"},{default:N(()=>[h(M,{class:"flex align-items-center justify-content-center",size:19},{default:N(()=>[h(H,{style:{height:"93vh"},layout:"vertical"},{default:N(()=>[h(M,{class:"flex align-items-center justify-content-center",size:100},{default:N(()=>[h(A,{selectionKeys:s(i),"onUpdate:selectionKeys":t[5]||(t[5]=c=>T(i)?i.value=c:null),value:s(u),style:{"padding-left":"0"},selectionMode:"single"},null,8,["selectionKeys","value"])]),_:1}),h(M,{class:"flex align-items-center justify-content-center",size:10,style:{display:"flex",padding:"1cap",gap:"1cap"}},{default:N(()=>[s(_)?j("",!0):(E(),O(o,{key:0,label:"Назад",onClick:t[6]||(t[6]=c=>("navigateTo"in d?d.navigateTo:s(he))("/"))})),s(_)?j("",!0):(E(),O(o,{key:1,label:"Добавить",onClick:t[7]||(t[7]=c=>{i.value={},a.value=!0})})),s(_)?j("",!0):(E(),O(o,{key:2,label:"Удаление",severity:"danger",onClick:t[8]||(t[8]=c=>{i.value={},_.value=!0})})),s(_)?(E(),O(o,{key:3,label:"Отключить режим удлаения!",severity:"success",onClick:t[9]||(t[9]=c=>_.value=!1)})):j("",!0)]),_:1})]),_:1})]),_:1}),h(M,{class:"content"},{default:N(()=>[h(ee),s(L)&&!s(_)?(E(),K("div",Xe,[s(L)&&!s(_)?(E(),O(m,{key:0,style:{"margin-bottom":"1vh"},placeholder:"Заголовок",modelValue:s(v),"onUpdate:modelValue":t[10]||(t[10]=c=>T(v)?v.value=c:null)},null,8,["modelValue"])):j("",!0),w("div",Ye,[h(te,{modelValue:s(V),"onUpdate:modelValue":t[11]||(t[11]=c=>T(V)?V.value=c:null)},null,8,["modelValue"]),_e(" Доступ по подписке ")])])):j("",!0),s(L)&&!s(_)?(E(),O(s(Le),{key:1,"api-key":"31akgpsno37ey6ez7rnhezqwdyrgp5exjk0twbwook8s4k6o",style:{height:"100%","border-radius":"6px"},modelValue:s(r),"onUpdate:modelValue":t[12]||(t[12]=c=>T(r)?r.value=c:null),init:U},null,8,["modelValue"])):j("",!0),h(o,{label:"Сохранить",onClick:y,style:{position:"absolute",bottom:"20px",right:"30px"}})]),_:1})]),_:1})])}}}),Et=we(Ze,[["__scopeId","data-v-77791752"]]);export{Et as default};
